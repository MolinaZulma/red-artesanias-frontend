YUI.add("explore-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,langBundles:this.details.langBundles,remote:{read:function(t){return e.ListFetchers["flickr-interestingness-getList"].run(t,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-interestingness-getList"]}},totalItems:{defaultValue:0,setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-explore-getContext"],listItemIdField:"photoId"}},displayType:{readOnly:!0,defaultValue:"explore"},url:{readOnly:!0,defaultFn:function(e){return"/explore/"+e.replace(/-/g,"/")}},urlSuffix:{readOnly:!0,defaultFn:function(e){return"explore-"+e}},title:{readOnly:!0,defaultFn:function(t){return this.intlMessage({intlName:"models.EXPLORE_TITLE",date:e.moment(t,"YYYY-MM-DD").toDate()})}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-interestingness-getList-fetcher","flickr-explore-getContext-fetcher","moment"],langBundles:["models"]});YUI.add("flickr-interestingness-getList-fetcher",(function(e,t){e.namespace("ListFetchers")["flickr-interestingness-getList"]={run:function(o,r){var s,p=this,i=this._processParams(o,r);return s=[r.callAPI("flickr.interestingness.getList",i),r.getModelRegistry("explore-models"),r.getModelRegistry("photo-lite-models")],e.Promise.all(s).then((function(e){return p._processResponse(e,o)}),e.FetcherErrorLogger(t))},_processParams:function(t,o){var r;return r={extras:e.APIHelper.request.getRebootPhotoLiteExtras(),per_page:t.perPage||100,page:t.page||"1",date:t.id},o.flipper.isFlipped("enable-explore-v2-api")&&(r.version="v2"),e.merge(r,t.apiParams||{})},_processResponse:function(t,o){var r,s,p=t[0],i=t[1],a=t[2],n={id:o.id};if(!o.id)throw new ReferenceError("No `id` provided by request.");if(!p.photos||!p.photos.photo)throw new Error("No `photos.photo` property returned by API.");return r=p.photos.photo.map((function(t){return s=e.APIHelper.response.parsePhotoLite(t),a.addOrUpdate(s)})),n.photos={perPage:p.photos.perpage,page:p.photos.page||1,pageContent:r,totalItems:p.photos.total,totalPages:p.photos.pages},n.totalItems=p.photos.total,i.addOrUpdate(n),n.photos.pageContent}}}),"@VERSION@",{requires:["api-helper","flickr-promise"],optional:["explore-models","photo-lite-models"]});YUI.add("explore-rail-card-view",(function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("explore-rail-card-view",e.Views["rail-card-view"],[],{langBundles:this.details.langBundles,initializer:function(t){this.params=t,this.justifiedLayout=require("justified-layout"),this.photoCardHelper=new e.PhotoCardHelper(this.appContext),this.photoItems=t.photoItems||[]},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("explore-rail-card",{})},activate:function(){var t=this,i=this.get("container");return this.isRerender||e.Analytics.sendClick("Rail Card Type: Explore","Rail Card Loaded"),this.listContainerNode=i.one(".list-container"),this.dummyLoaderNode=this.listContainerNode.one(".dummy-loader"),this.currentContainerWidth=i.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),(this.photoItems&&this.photoItems.length>0?e.Promise.resolve():this.loadExplore()).then((()=>t.buildLayout())).then((()=>(t.dummyLoaderNode.addClass("hidden"),this)))},buildLayout:function(){var t,i=this,o=e.Node.create('<div class="explore-layout"></div>'),n=[],r="/in/explore",a=i.photoItems.map((function(e){return Math.min(e.aspectRatio,2)})),s=0,l=0,h=0;return(t=i.justifiedLayout(a,{containerWidth:this.listContainerNode.get("clientWidth"),containerPadding:0,boxSpacing:{horizontal:4,vertical:4},targetRowHeight:70,targetRowHeightTolerance:.2})).boxes.some((function(e,i){l<e.top&&(l=e.top,++s>=2&&(h=h||i,t.containerHeight=t.containerHeight-e.height-4))})),h||(h=t.boxes.length),t.boxes=t.boxes.slice(0,h),this.listContainerNode.appendChild(o),o.setStyle("position","relative"),o.setStyle("height",t.containerHeight),t.boxes.forEach((function(t,o){var a=i.photoItems[o];n.push(i.appContext.getView("photo-card-view",{box:t,isAwakeInitially:!0,photoConfig:{photoItem:a,box:t,urlContext:r,showPhotoInterstitial:a.needsInterstitial,photoInterstitialContent:a.needsInterstitial?i.templates("adult-content-photo-overlay")({...i.appContext.flipper.isFlipped("enable-nsfw-2024")?e.NSFWHelper.getPhotoCardConfig():{},photoId:a.id+r,photoUrl:a.url+r,isCompact:!0}):void 0}}).then((function(e){return e.initialize()})))})),e.Promise.all(n).then((function(i){return i.forEach((function(i,n){var r=i.params.photoConfig.photoItem,a=t.boxes[n],s=i.get("container"),l=e.Node.create('<div class="explore-photo-item" data-item-id="'+r.id+'"></div>');l.setStyle("position","absolute"),l.setStyle("display","flex"),l.setStyle("flex-direction","column"),l.setStyle("top",a.top),l.setStyle("left",a.left),l.appendChild(s),o.appendChild(l),i.activate()})),o}))},loadExplore:function(){var t=this,i=e.moment.utc().subtract({days:1,hours:4}),o=[i.format("YYYY"),i.format("MM"),i.format("DD")].join("-"),n={id:o,apiParams:{date:o,page:1,per_page:15}};return this.appContext.getModel("explore-models",n).then((function(e){t.exploreModel=e,t.photoItems=e.getValue("photos").getList().map((function(e){return t.photoCardHelper.convertPhotoModel(e)}))}))},handlePageResize:function(){var e=this.get("container").get("clientWidth");e!==this.currentContainerWidth&&(this.currentContainerWidth=e,this.rerender())}})}),"@VERSION@",{requires:["flickr-view","rail-card-view","photo-card-view","hermes-template-explore-rail-card","hermes-template-adult-content-photo-overlay","explore-models","moment","nsfw-helper"],optionalRequires:["hermes-core"],langBundles:["common","adult-content-overlay","feed"]});YUI.add("hermes-template-group-recs-rail-card",(function(t,i){var s=t.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(t,i,s,e,n){var a=t.lookupProperty||function(t,i){if(Object.prototype.hasOwnProperty.call(t,i))return t[i]};return'<div class="group-recs-rail-card">\n\t<h2 class="title">\n\t\t'+t.escapeExpression((a(s,"intlMessage")||i&&a(i,"intlMessage")||t.hooks.helperMissing).call(null!=i?i:t.nullContext||{},{name:"intlMessage",hash:{intlName:"feed.GROUPS_FOR_YOU"},data:n,loc:{start:{line:3,column:2},end:{line:3,column:48}}}))+'\n\t</h2>\n\t<div class="list-container">\n\t\t<div class="dummy-loader">\n\t\t\t<div class="row">\n\t\t\t\t<div class="attribution-section">\n\t\t\t\t\t<div class="attribution-left">\n\t\t\t\t\t\t<div class="box ava" style="height: 32px; width: 32px"></div>\n\t\t\t\t\t\t<div class="box" style="height: 14px; width: 30%"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="attribution-right">\n\t\t\t\t\t\t<div class="box" style="height: 32px; width: 64px"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="list-section">\n\t\t\t\t\t<div class="box" style="height: 60px; width: 30%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 20%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 25%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 20%"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="row">\n\t\t\t\t<div class="attribution-section">\n\t\t\t\t\t<div class="attribution-left">\n\t\t\t\t\t\t<div class="box ava" style="height: 32px; width: 32px"></div>\n\t\t\t\t\t\t<div class="box" style="height: 14px; width: 30%"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="attribution-right">\n\t\t\t\t\t\t<div class="box" style="height: 32px; width: 64px"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="list-section">\n\t\t\t\t\t<div class="box" style="height: 60px; width: 20%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 20%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 30%"></div>\n\t\t\t\t\t<div class="box" style="height: 60px; width: 25%"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),e={};t.Array.each([],(function(i){var s=t.Template.get("hermes/"+i);s&&(e[i]=s)})),t.Template.register("hermes/group-recs-rail-card",(function(i,n){return(n=n||{}).partials=n.partials?t.merge(e,n.partials):e,s(i,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("flickr-groups-recommendations-fetcher",(function(e,r){"use strict";function o(e){return e.sample_photos_count=8,e}e.namespace("ModelFetchers")["flickr-groups-recommendations"]={run:function(s,p){var t=this,n=o({page:s.page||1,per_page:s.perPage||4,extras:(s.extras||"")+",icon_urls, sizes"});return e.Promise.all([p.callAPI("flickr.groups.recommendations",n,!0),p.getModelRegistry("group-recommended-list-models"),p.getModelRegistry("group-recommended-models")]).then((function(e){return t._processResponse(e,n,s)}),e.FetcherErrorLogger(r))},_processParams:o,_processResponse:function(r,o,s){var p=r[0].groups.group,t=r[1],n=r[2],a={},i=[];return e.each(p,(function(e){var r;e.id=e.nsid,r=n.parseGroupModel(e),n.addOrUpdate(r),i.push(n.proxy(r.id))})),a.id="none",a.groups={perPage:o.per_page,page:o.page,pageContent:i,totalItems:r[0].groups.total},t.addOrUpdate(a),i}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["group-info-models","group-models"]});YUI.add("group-recommended-list-models",(function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.ModelFetchers["flickr-groups-recommendations"].run(r,this.appContext)}},attributes:{groups:{isCollection:!0,pageFetch:{listFetcher:e.ModelFetchers["flickr-groups-recommendations"]}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-groups-recommendations-fetcher","attribute-helpers"]});YUI.add("group-recs-rail-card-view",(function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("group-recs-rail-card-view",e.Views["rail-card-view"],[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.groupRecs=e.groupRecs,this.justifiedLayout=require("justified-layout")},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("group-recs-rail-card",{})},activate:function(){var t=this,i=this.get("container");return this.isRerender||e.Analytics.sendClick("Rail Card Type: Group Recs","Rail Card Loaded"),this.listContainerNode=i.one(".list-container"),this.dummyLoaderNode=this.listContainerNode.one(".dummy-loader"),this.currentContainerWidth=i.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),(this.groupRecs&&this.groupRecs.length>0?e.Promise.resolve():this.loadRecs()).then((()=>t.buildLayout())).then((()=>(t.dummyLoaderNode.addClass("hidden"),this)))},buildLayout:function(){var e=this;e.groupRecs.forEach((function(t){e.buildGroupLayout(t)}))},buildGroupLayout:function(e){var t=this;this.appContext.getView("group-recs-rail-item-view",Object.assign({appContext:this.appContext},e)).then((function(e){return e.initialize()})).then((function(e){return t.listContainerNode.appendChild(e.get("container")),e.activate()}))},loadRecs:function(){var e=this;return this.appContext.getModel("group-recommended-list-models",{id:"none",perPage:2}).then((function(t){e.recsModel=t,e.groupRecs=t.getValue("groups").getList().map((function(e){return Object.assign({model:e},e.toJSON())}))}))},handlePageResize:function(){var e=this.get("container").get("clientWidth");e!==this.currentContainerWidth&&(this.currentContainerWidth=e,this.rerender())}})}),"@VERSION@",{requires:["flickr-view","rail-card-view","photo-card-view","group-recs-rail-item-view","hermes-template-group-recs-rail-card","hermes-template-group-recs-rail-item","hermes-template-adult-content-photo-overlay","group-recommended-list-models"],optionalRequires:["hermes-core"],langBundles:["common","adult-content-overlay","feed"]});