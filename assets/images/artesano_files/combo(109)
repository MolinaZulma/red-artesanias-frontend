YUI.add("photo-page-sidebar-view",(function(e,t){let i=require("hermes-core/flog")(t),o=new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,additionalViewClasses:["clear-float","photo-attribution"],parentViewName:this.name},"sub-photo-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,parentViewName:this.name},"photo-charm-exif-scrappy-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,parentViewName:this.name},"sub-photo-right-stats-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,parentViewName:this.name},"sub-photo-date-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,parentViewName:this.name},"getty-widget-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,type:"photoPage",sidebar:!0,disabled:function(){return!this.appContext.gettyHelper.canShowWidgetType()||this.appContext.adManager.userCanViewPhotoPageSidebar()}},"sub-photo-submoola-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,showUpgradeProLink:!1,adPosition:0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-sidebar-ad-recoupling")||!this.appContext.adManager.canShowAd(this)||this._params.ownerIsPro}},"explore-rail-card-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-interstitial-ad-on-photopage")}},"group-recs-rail-card-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-interstitial-ad-on-photopage")}}},initializer:function(t){return this.photoId=t.photoId,this.detachedConfig,this.showPhotoPageAd=!0,this.showGettyWidget=!1,this.nodeObserver,this.sidebarResizeThrottle=16,this.params=t,this.isAd=t.isAd||!1,e.Promise.resolve()},loadState:function(){let t=this;return this.appContext.getModel("photo-models",t.photoId).then((function(o){if(t.set("photo",o),t.appContext.adManager.canShowAdWithPhoto(t.get("photo"))){if(t.appContext.flipper.isFlipped("enable-page-categorizations"))return t.appContext.getModel("page-categorizations-models",t.photoId).then((function(i){t.set("categories",i.getValue("categories")),e.Snowplough.sendSelfDescribingEvent({schema:e.Snowplough.SCHEMAS.PAGE_CATEGORIZATIONS,data:{photoId:parseInt(t.photoId,10),status:"received",result:[t.get("categories")],source:i.getValue("source")}})})).catch((function(e){i.error("Error loading photo categorizations: ",e)}))}else t.showPhotoPageAd=!1}))},buildContainer:function(){this.setContainerWithTemplate("photo-page-sidebar",{showGettyWidget:this.showGettyWidget,sidebarWidth:e.config.flickr.photopage.sidebarWidth,isAd:this.isAd,upgradeUrl:o.getProLandingPageUrl(o.UTM_INTERSTITIAL_SIDEBAR)})},activate:function(){let t=!1,i=this.get("container"),o=this,a=o.get("photo");return this.isAd?(this.setCorrectSidebarHeight(),this.registerEventHandler(e.on("resize",e.betterThrottle((e=>{this.setCorrectSidebarHeight()}),this.sidebarResizeThrottle,this))),e.Promise.resolve()):(this.registerEventHandler(i.one(".fave-count").on("click",this.faveCountClicked.bind(this))),this.registerEventHandler(i.one(".comment-count").on("click",this.commentCountClicked.bind(this))),this.appContext.flipper.isFlipped("enable-sidebar-ad-recoupling")||this.registerEventHandler(e.on("resize",e.betterThrottle((t=>{this.showGettyWidget||(this.showPhotoPageAd&&this.appContext.viewportData.getWidthWithScrollbars()>=1081?e.one("body").one(".detached-moola-unit")||this.setDetachedMoolaUnit():e.one("body").one(".detached-moola-unit")&&this.appContext.adManager.removeDetachedAdUnit()),this.setCorrectSidebarHeight()}),this.sidebarResizeThrottle,this))),this.showGettyWidget?(a&&this.registerEventHandler(a.on("valuesChanged",(function(e){e.safetyLevel&&o.canShowGettyWidget()}))),this.canShowGettyWidget(),t=!1):this.showPhotoPageAd?this.appContext.viewportData.getWidthWithScrollbars()>=1081&&(t=!0):(i.one(".moola-content-spacing")&&i.one(".moola-content-spacing").setStyle("display","none"),this.appContext.adManager.destroyAdUnitsOnPage(!0)),this.setCorrectSidebarHeight(),this.appContext.flipper.isFlipped("enable-sidebar-ad-recoupling")||t&&this.setDetachedMoolaUnit(),this.setSiblingObserver(),e.Promise.resolve())},canShowGettyWidget:function(){let e=this.showGettyWidget,t=this.get("photo");this.appContext.adManager.canShowAdWithPhoto(t)&&this.appContext.gettyHelper.canShowWidgetType()?this.showGettyWidget=!1:this.showGettyWidget=!0,e!==this.showGettyWidget&&this.buildContainer()},faveCountClicked:function(t,i){t.preventDefault();var o=new e.Views["photo-faves-list-view"]({photoId:this.photoId,appContext:this.appContext});this.favesModal=new e.Views.FluidModal({appContext:this.appContext,subview:o,height:550,flexLayout:!0,hasSubviewConfigRefactor:!0,theme:this.params.theme}),this.favesModal.show()},commentCountClicked:function(){var t={appContext:this.appContext,photoId:this.photoId,isScrollable:!0,hasHeader:!0},i=new e.ModalDroparoundHelper(this.appContext,{useViewportType:!1,containerType:"modal",configs:{common:{subviewName:"photo-comments-view",subviewParams:t},modal:{height:550,flexLayout:!0,theme:this.params.theme}}});this.registerEventHandler(i.on("close",(()=>{e.fire("photoCommentModalClosed",{photoId:this.photoId})}))),this.registerEventHandler(e.on("addComment:showingSignupModal",(()=>{i.close()}))),i.show()},setCorrectSidebarHeight:function(){let t,i,o=this.get("container"),a=e.one("body").one(".height-controller");o&&a&&o.one(".scrollable-container")&&(t=o.get("offsetHeight"),i=a.get("offsetHeight"),(i<t||i>t)&&o.setStyle("maxHeight",`${i}px`))},setDetachedMoolaUnit:function(){const t=this,i=this.get("container"),o=e.config.flickr.moola.positions.photopage[0],a=this.appContext.viewportData.getWidthWithScrollbars(),n=e.config.flickr.moola.ad_breakpoint_mobile_desktop;this.adConfig={adUnit:o[a<n?"ad_unit_mobile":"ad_unit_desktop"]},this.adEventStitch=this.appContext.adManager.getHashedAdValue(this.appContext.adManager.getAdPositioning(i)),this.adUnit=this.adConfig.adUnit,this.detachedConfig={template:this.templates("prbd-moola-position")({adUnit:this.adConfig.adUnit,advertisingStitching:this.adEventStitch,categories:this.appContext.flipper.isFlipped("enable-page-categorizations")?this.appContext.adManager.getAdCategories(this.get("categories")):"",class:"detached-moola-unit"}),detachedContainer:e.one("body").one("#detached-moola-container"),anchorNode:i.one(".moola-detached-container"),route:"photo-route"},this.registerEventHandler(e.on("resize",e.betterThrottle((e=>{this.appContext.adManager.repositionDetachedMoolaUnit(this.detachedConfig)}),this.sidebarResizeThrottle,this))),document.querySelector(".detached-moola-unit")||this.registerEventHandler(e.on("photoPage:dataLayerReadyForAds",(()=>{this.appContext.adManager.initDetachedMoolaUnit(this.detachedConfig),this.appContext.adManager.processAdsOnPage(),this.appContext.adManager.signalAdRequest(this),this.detachedSanityCheck=setTimeout((function(){t.appContext.adManager.repositionDetachedMoolaUnit(t.detachedConfig),this.appContext.adManager.processAdsOnPage(),this.appContext.adManager.signalAdRequest(this),clearTimeout(t.detachedSanityCheck)}),500)})))},setSiblingObserver:function(){const e=this.get("container").getDOMNode();this.nodeObserver=new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&(this.get("container").one(".moola-detached-container")&&this.showPhotoPageAd?(this.setCorrectSidebarHeight(),this.appContext.adManager.repositionDetachedMoolaUnit(this.detachedConfig)):this.setCorrectSidebarHeight())}))}));this.nodeObserver.observe(e,{childList:!0,subtree:!0})},destructor:function(){this.nodeObserver&&this.nodeObserver.disconnect&&this.nodeObserver.disconnect(),this.appContext.adManager.nextPhotoIsAdFriendly()||this.appContext.adManager.destroyAdUnitsOnPage(!0)}},{})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-sidebar","hermes-template-prbd-moola-position","attribution-view","sub-photo-title-desc-view","photo-charm-exif-scrappy-view","sub-photo-right-stats-view","sub-photo-date-view","photo-license-view","fluid-modal-view","fluid-droparound-view","getty-widget-view","sub-photo-submoola-view","explore-rail-card-view","group-recs-rail-card-view"],optionalRequires:["hermes-core"],optional:["photo-models"],langBundles:["photo-page-scrappy","common"]});